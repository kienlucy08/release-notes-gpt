<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>FieldSync Release Notes Generator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>
    <div class="container">
        <h1 class="custom-title">FieldSync Release Notes Generator</h1>

        <form method="POST" onsubmit="showLoading()">
            <div id="entries">
                <div class="entry-block">
                    <label for="sprint">Select Sprint</label>
                    <select name="sprint" class="input-select">
                        {% for sprint in sprints %}
                        <option value="{{ sprint.id }}" {% if sprint.name==sprint_name %}selected{% endif %}>
                            {{ sprint.name }}
                        </option>
                        {% endfor %}
                    </select>
                    <label for="type">Type</label>
                    <select name="type" class="input-select">
                        <option value="Feature">Feature</option>
                        <option value="Bug">Bug</option>
                    </select>

                    <label for="description">Description</label>
                    <textarea name="description" class="input-area" placeholder="Enter description..."></textarea>
                </div>
            </div>

            <div style="margin-top: 10px;">
                <button type="button" class="button-secondary" onclick="addEntry()">Add Another</button>
                <button id="generate-btn" type="submit" class="button-primary">Generate Release Notes</button>
            </div>
        </form>


        {% if entries %}
        <h2 class="section-title">Current Items</h2>
        <ul>
            {% for item in entries %}
            <li class="item-card">{{ item }}</li>
            {% endfor %}
        </ul>
        {% endif %}

        {% if results %}
        <h2 class="section-title">Generated Release Notes</h2>

        {% if was_chunked %}
        <div class="output-box">
            ‚ö†Ô∏è Heads up: Your notes were very long, so we split them into multiple chunks to generate properly.
        </div>
        {% endif %}

        <div class="output-box">{{ results | safe }}</div>


        <div class="output-box">{{ results | safe }}</div>

        {% if saved_file_path %}
        <div class="output-box">
            ‚úÖ Saved! <a href="{{ url_for('static', filename=saved_file_path) }}" target="_blank">View saved file</a>
        </div>
        {% endif %}

        <form method="POST" style="margin-top: 20px;">
            <input type="hidden" name="entries" value="{{ entries | tojson | safe }}">
            <input type="hidden" name="sprint_name" value="{{ sprint_name }}">

            {% if show_save_option %}
            <button type="submit" formaction="/save" class="button-primary">üíæ Save to Sprint Folder</button>
            {% endif %}

            <button type="submit" formaction="/delete" class="button-secondary"
                onclick="return confirm('Are you sure you want to delete this note?')">üóëÔ∏è Delete</button>
            <button type="submit" formaction="/" class="button-secondary">üîÑ Start Over</button>
        </form>
        {% endif %}

        {% if saved_notes %}
        <h2 class="section-title">Past Sprint Notes</h2>
        <ul>
            {% for sprint in saved_notes %}
            <li class="item-card">
                <strong>{{ sprint.name }}</strong>
                <form method="POST" action="/delete_txts" style="display:inline;">
                    <input type="hidden" name="sprint_folder" value="{{ sprint.folder }}">
                    <button type="submit" class="button-secondary"
                        onclick="return confirm('Delete all release notes for this sprint?')">üóëÔ∏è Delete Notes</button>
                </form>
                <ul>
                    {% for file in sprint.files %}
                    <li>
                        <a href="{{ url_for('static', filename='saved_notes/' ~ sprint.folder ~ '/' ~ file) }}"
                            target="_blank">{{ file }}</a>
                    </li>
                    {% endfor %}
                </ul>
            </li>
            {% endfor %}
        </ul>
        {% endif %}

    </div>

    <script>
        function addEntry() {
            const block = document.createElement('div');
            block.className = 'entry-block';
            block.innerHTML = `
            <label>Type</label>
            <select name="type" class="input-select">
                <option value="Feature">Feature</option>
                <option value="Bug">Bug</option>
            </select>
            <label>Description</label>
            <textarea name="description" class="input-area" placeholder="Enter description..."></textarea>
        `;
            document.getElementById('entries').appendChild(block);
        }

        function showLoading() {
            const button = document.getElementById("generate-btn");
            button.disabled = true;
            button.innerHTML = "Generating...";
            button.classList.add("loading");
        }
    </script>

</body>

</html>